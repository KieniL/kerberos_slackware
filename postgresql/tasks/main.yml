---
# tasks file for ftp

- name: download ftp
  get_url:
    url: ftp://ftp.slackware.com/pub/slackware/slackware-10.1/slackware/n/vsftpd-2.0.1-i486-1.tgz
    dest: ./ftp.tgz
  delegate_to: 127.0.0.1

- name: copy ftp.tgz to remote machine
  copy:
    src: ./ftp.tgz
    dest: /root/ftp.tgz
    owner: root
    group: root
    mode: 0644

- name: Create the ftp directory if it does not exist
  file:
    path: /root/ftp
    state: directory
    mode: '0755'
    owner: root
    group: root

- name: Extract ftp.tgz into /root/ftp
  unarchive:
    src: ftp.tgz
    dest: /root/ftp


- name: copy the vsftp binaries into /usr/sbin
  copy:
    src: /root/ftp/usr/sbin/
    dest: /usr/sbin/
    mode: 0755
    remote_src: true
    directory_mode: true

- name: copy the ftp home folder into /home
  copy:
    src: /root/ftp/home/
    dest: /home/
    mode: 0755
    remote_src: true
    directory_mode: true

- name: copy the vsftp config into /etc
  copy:
    src: /root/ftp/usr/doc/vsftpd-2.0.1/EXAMPLE/INTERNET_SITE_NOINETD/vsftpd.conf
    dest: /etc/vsftpd.conf
    mode: 0755
    remote_src: true

- name: start vsftp
  command: vsftpd &
  register: vsftpd
  failed_when: vsftpd.stdout != ""


#- name: enable listen yes in vsftp config
#  lineinfile:
#    dest: /etc/vsftpd.conf
#    regexp: "^#listen=YES"
#    line: "listen=YES"
    
    #listen=YES